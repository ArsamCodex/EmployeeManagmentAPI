@page "/audit-logs"
@using EmployeeManagmentClient.Services
@using Microsoft.AspNetCore.Authorization
@inject HttpClient Http
@inject JwtAuthStateProvider Auth
@inject NavigationManager Nav
@attribute [Authorize(Roles = "Admin")]
@inject ApiClient Api

<h3>Audit / Logs</h3>

@if (logs == null)
{
    <p>Loading logs...</p>
}
else
{
    <table class="role-table audit-table">
        <thead>
            <tr>
                <th>Timestamp</th>
                <th>User</th>
                <th>Action</th>
                <th>Description</th>
                <th>IP</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var log in logs)
            {
                <tr>
                    <td>@log.Timestamp.ToLocalTime()</td>
                    <td>@log.UserEmail</td>
                    <td>@log.Action</td>
                    <td>@log.Description</td>
                    <td>@log.IpAdress</td>

                </tr>
            }
        </tbody>
    </table>
}

@code {
    List<AuditLogDto> logs;

    protected override async Task OnInitializedAsync()
    {
        await LoadLogs();
    }
    private async Task LoadLogs()
    {
        try
        {
            // Use ApiClient GET for JWT-protected endpoint
            logs = await Api.GetListAsync<AuditLogDto>("api/roles/audit-logs");
        }
        catch
        {
            logs = new List<AuditLogDto>();
        }
    }
 
    public class AuditLogDto
    {
        public string UserEmail { get; set; }
        public string Action { get; set; }
        public string Description { get; set; }
        public DateTime Timestamp { get; set; }
        public string IpAdress { get; set; }

    }
}
